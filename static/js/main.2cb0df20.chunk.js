(this.webpackJsonpreich=this.webpackJsonpreich||[]).push([[0],{16:function(e,t,n){},18:function(e,t,n){"use strict";n.r(t);var c=n(1),a=n.n(c),s=n(10),i=n.n(s),r=(n(16),n(2)),l=n(9),o=n(3),u=function(e,t,n,c){var a=e.scrollTop,s=t-e.scrollTop,i=performance.now();requestAnimationFrame((function r(){var l=performance.now()-i;l>n?e.scrollTop=t:(e.scrollTop=c(l,a,s,n),requestAnimationFrame(r))}))},h=n(0),d=a.a.forwardRef((function(e,t){var n=e.clapPattern,c=e.head,a=e.shift,s=e.highlightPulse,i=e.currentPattern,r=e.donePattern,l=e.userInput,o=e.className;return Object(h.jsxs)("div",{ref:t,className:"clap-row ".concat(o),children:[Object(h.jsx)("div",{className:"head",children:c}),Object(h.jsx)("div",{className:"pattern",children:n.map((function(e,t){var c=(t+a)%n.length,o=n[c],u="cell pulse ".concat(o?"clap":"silence"," ").concat(t===s?"highlight":""," "),d=void 0===l||void 0===l[t],p=d?"no-hit":l[t]>2/3?"hit-bad":l[t]>1/3?"hit-ok":"hit-good";return i?(t<s||t===s&&!d)&&(u+=p):(r||void 0!==l)&&(u+=p),Object(h.jsx)("div",{className:u},t)}))})]})}));d.defaultProps={head:"",shift:0,className:""};var p=d,b=function(e,t,n,c){return n*Math.sin(e/c*(Math.PI/2))+t},f=function(e){var t=e.buttonHandler,n=e.buttonLabel,a=e.clapPattern,s=e.pattern,i=e.pulse,r=e.repeats,l=e.userInput,o=e.className,d=s;(void 0===s||s<=0)&&(s=0);var f=Object(c.useRef)([]),j=Object(c.useRef)(null),m=Object(c.useCallback)((function(e){u(document.scrollingElement,f.current[1+e].offsetTop-f.current[1].offsetTop+j.current.offsetTop+4,300,b)}),[]),v=(a.length+1)*r;return Object(c.useEffect)((function(){void 0!==d&&m(Math.max(0,Math.min(v-1,d)))}),[d,m,v]),Object(h.jsxs)("div",{className:"pattern-table noselect ".concat(o),ref:function(e){j.current=e},children:[Object(h.jsxs)("div",{className:"arrow-row",children:[Object(h.jsx)("div",{className:"head",children:Object(h.jsx)("button",{className:"noselect",onClick:t,children:n})}),Object(h.jsx)("div",{className:"pattern",children:a.map((function(e,t){return Object(h.jsx)("div",{className:"cell arrow",children:d>=-1&&t===i?"\u25bc":""},t)}))})]}),Object(h.jsx)("div",{className:"pattern-clap1",children:Object(h.jsx)(p,{clapPattern:a,head:"Clap 1 \u27a1",shift:0,highlightPulse:i})}),Object(h.jsxs)("div",{className:"pattern-clap2",children:[Array(1).fill().map((function(e,t){return Object(h.jsx)(p,{ref:function(e){f.current[t]=e},clapPattern:a,className:"empty"},t)})),Array(v).fill().map((function(e,t){return Object(h.jsx)(p,{ref:function(e){f.current[t+1]=e},clapPattern:a,className:t===s?"highlight":"",highlightPulse:t===s?i:void 0,head:t===s?"Clap 2 \u27a1":"",shift:Math.floor(t/r),userInput:l[t],donePattern:t<d,currentPattern:t===d},t)})),Object(h.jsxs)("div",{className:"padder",children:[Object(h.jsx)("div",{className:"head"}),Object(h.jsx)("div",{className:"pattern empty",children:a.map((function(e,t){return Object(h.jsx)("div",{className:"cell pulse"},t)}))})]})]})]})};f.defaultProps={className:""};var j=f,m=n(11),v=function(e){var t=e.label,n=Object(m.a)(e,["label"]);return Object(h.jsxs)("label",{children:["checkbox"!==n.type?Object(h.jsx)("span",{className:"label noselect",children:t}):null,Object(h.jsx)("input",Object(r.a)({},n)),"checkbox"===n.type?Object(h.jsx)("span",{className:"label noselect",children:t}):null]})},O=n(6),g=n(7),x=function(){function e(t,n){Object(O.a)(this,e),this.f=n,this.context=t,this.oscillator=t.createOscillator(),this.oscillator.type="square",this.oscillator.frequency.value=n,this.gain=t.createGain(),this.gain.gain.value=0,this.oscillator.start(),this.oscillator.connect(this.gain),this.gain.connect(t.destination)}return Object(g.a)(e,[{key:"schedule",value:function(e,t,n){this.gain.gain.setValueAtTime(e,t),this.gain.gain.setValueAtTime(0,n)}},{key:"scheduleFrequency",value:function(e,t){this.oscillator.frequency.setValueAtTime(e,t)}},{key:"cancelScheduledValues",value:function(){var e=this.context.currentTime;this.oscillator.frequency.cancelScheduledValues(e),this.gain.gain.cancelScheduledValues(e),this.gain.gain.value=0,this.oscillator.frequency.value=this.f}},{key:"disconnect",value:function(){this.gain.disconnect(),this.oscillator.disconnect()}}]),e}(),k=function(e,t){return(t+e%t)%t},y=function(e){return 60/e},T=function(e,t,n,c){var a=(c-n)/y(e);return 2*Math.floor(a)+(k(a,1)<t?0:1)},w=function(e,t,n,c){return n+(Math.floor(c/2)+(c%2===0?0:t))*y(e)},P=.0125,C=function(){function e(t,n,c,a,s,i,r,l,o,u){Object(O.a)(this,e),this.audioContext=t,this.clapPattern=n,this.clap1Osc=new x(this.audioContext,440),this.clap2Osc=new x(this.audioContext,230),this.metronomeOsc=new x(this.audioContext,1780),this.startTime=null,this.lastPulse=null,this.bpm=c,this.repeats=a,this.swing=s,this.clap1=i,this.clap2=r,this.metronome=l,this.countMetronome=o,this.onUpdate=u}return Object(g.a)(e,[{key:"start",value:function(){var e=this;this.stop(),this.audioContext.resume(),this.startTime=this.audioContext.currentTime+y(this.bpm)/2*this.clapPattern.length,this.countMetronome&&this.metronomeOsc.schedule(1,this.startTime,this.startTime+P),this.onUpdate(this.startTime,this.startTime);requestAnimationFrame((function t(){e.schedule(),null!==e.startTime&&requestAnimationFrame(t)}))}},{key:"stop",value:function(){this.startTime=null,this.lastPulse=null,this.clap1Osc.cancelScheduledValues(),this.clap2Osc.cancelScheduledValues(),this.metronomeOsc.cancelScheduledValues(),this.onUpdate(null,null)}},{key:"destroy",value:function(){this.stop(),this.clap1Osc.disconnect(),this.clap2Osc.disconnect(),this.metronomeOsc.disconnect()}},{key:"schedule",value:function(){if(null!==this.startTime){var e=T(this.bpm,this.swing,this.startTime,this.audioContext.currentTime),t=(this.clapPattern.length+1)*this.repeats*this.clapPattern.length;if(e>=t)this.stop();else if(e!==this.lastPulse)this.lastPulse=e,e+1>=t||(this.schedulePulseSound(e+1),this.onUpdate(this.startTime,this.audioContext.currentTime))}}},{key:"schedulePulseSound",value:function(e){var t=Math.floor(e/this.clapPattern.length),n=k(e,this.clapPattern.length),c=w(this.bpm,this.swing,this.startTime,e),a=c+P,s=0===n?1:.25;if(t>=0){this.clap1&&this.clapPattern[n%this.clapPattern.length]&&this.clap1Osc.schedule(s,c,a);var i=Math.floor(t/this.repeats);this.clap2&&this.clapPattern[(i+n)%this.clapPattern.length]&&this.clap2Osc.schedule(s,c,a)}var r=this.metronome&&t>=0&&n%2===0,l=this.countMetronome&&-1===t&&n%2===0;(r||l)&&(this.metronomeOsc.scheduleFrequency(0===n?1780:890,c),this.metronomeOsc.schedule(s,c,a))}}]),e}(),N=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.min,a=t.max,s=t.step,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,r=Object(c.useCallback)((function(e){var t=parseInt(e,10);return Number.isInteger(t)?(void 0!==n&&(t=Math.max(n,t)),void 0!==a&&(t=Math.min(a,t)),t):i}),[n,a,i]),l=Object(c.useState)((function(){return r(localStorage.getItem(e))})),u=Object(o.a)(l,2),h=u[0],d=u[1],p=Object(c.useCallback)((function(t){var n=t.target.value,c=r(n);localStorage.setItem(e,c),d(c)}),[e,r]);return{type:"number",min:n,max:a,step:s,value:h,onChange:p}},S=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.min,a=t.max,s=t.step,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,r=Object(c.useCallback)((function(e){var t=parseFloat(e,10);return"number"!==typeof t||isNaN(t)?i:(void 0!==n&&(t=Math.max(n,t)),void 0!==a&&(t=Math.min(a,t)),t)}),[n,a,i]),l=Object(c.useState)((function(){return r(localStorage.getItem(e))})),u=Object(o.a)(l,2),h=u[0],d=u[1],p=Object(c.useCallback)((function(t){var n=t.target.value,c=r(n);localStorage.setItem(e,c),d(c)}),[e,r]);return{type:"number",min:n,max:a,step:s,value:h,onChange:p}},M=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Object(c.useCallback)((function(e){return!0===e||"true"===e||!1!==e&&"false"!==e&&t}),[t]),a=Object(c.useState)((function(){return n(localStorage.getItem(e))})),s=Object(o.a)(a,2),i=s[0],r=s[1],l=Object(c.useCallback)((function(t){var c=t.target.checked,a=n(c);localStorage.setItem(e,a),r(a)}),[e,n]);return{type:"checkbox",checked:i,onChange:l}},I=[!0,!0,!0,!1,!0,!0,!1,!0,!1,!0,!0,!1],E=[90],F=[77],q=function(e){var t,n,a,s,i=e.context,u=Object(c.useState)({startTime:null,now:null}),d=Object(o.a)(u,2),p=d[0],b=d[1],f=Object(c.useState)([]),m=Object(o.a)(f,2),O=m[0],g=m[1],x=N("tempo",{min:1,max:999,step:1},120),P=N("repeats",{min:1,max:999,step:1},4),q=S("swing",{min:.1,max:.9,step:.01},.5),A=M("clap1",!0),R=M("clap2",!0),V=M("metronome",!1),D=M("countMetronome",!0),L=Object(c.useRef)(),_=Object(c.useCallback)((function(){L.current.start(),g([])}),[]),H=Object(c.useCallback)((function(){L.current.stop()}),[]);if(Object(c.useEffect)((function(){return L.current=new C(i,I,x.value,P.value,q.value,A.checked,R.checked,V.checked,D.checked,(function(e,t){b({startTime:e,now:t})})),function(){L.current.destroy()}}),[i]),Object(c.useEffect)((function(){L.current.bpm=x.value}),[x.value]),Object(c.useEffect)((function(){L.current.repeats=P.value}),[P.value]),Object(c.useEffect)((function(){L.current.swing=q.value}),[q.value]),Object(c.useEffect)((function(){L.current.clap1=A.checked}),[A.checked]),Object(c.useEffect)((function(){L.current.clap2=R.checked}),[R.checked]),Object(c.useEffect)((function(){L.current.metronome=V.checked}),[V.checked]),Object(c.useEffect)((function(){L.current.countMetronome=D.checked}),[D.checked]),Object(c.useEffect)((function(){var e=function(e){var t=e.repeat,n=e.key,c=e.keyCode,a=e.timeStamp;if(!t&&null!==p.startTime){var s=T(x.value,q.value,p.startTime,i.currentTime),r=(performance.now()-a)/1e3,o=function(e,t,n,c){var a=T(e,t,n,c),s=y(e);return{currPulseDiff:(c-w(e,t,n,a))/(s*t),nextPulseDiff:(w(e,t,n,a+1)-c)/(s*(1-t))}}(x.value,q.value,p.startTime,i.currentTime-r),u=o.currPulseDiff,h=o.nextPulseDiff;E.includes(c)?(console.log("clap1",u,h),g((function(e){var t=s+(u>=h?1:0),n=u>=h?h:u,c=Math.floor(t/I.length),a=k(t,I.length);return(e=Object(l.a)(e))[c]=Object(l.a)(e[c]||[]),e[c][a]=n,e}))):F.includes(c)?console.log("clap2",u,h):console.log(n,c)}};return window.addEventListener("keydown",e,!1),function(){window.removeEventListener("keydown",e,!1)}}),[x.value,q.value,p.startTime,i]),null!==p.startTime){var U=T(x.value,q.value,p.startTime,i.currentTime);t=Math.floor(U/I.length),n=k(U,I.length)}return void 0===t?(a=_,s="Start"):t<0?(a=H,s=Math.floor(n/2)+1):(a=H,s="Stop"),Object(h.jsxs)("div",{className:"reich-app",children:[Object(h.jsx)("header",{children:Object(h.jsx)("h1",{children:Object(h.jsx)("a",{href:"/reich",children:"Reich Clapping Trainer"})})}),Object(h.jsxs)("section",{children:[Object(h.jsxs)("p",{children:[Object(h.jsx)("a",{href:"https://en.wikipedia.org/wiki/Clapping_Music",target:"_blank",rel:"noopener noreferrer",children:"Clapping Music"})," ","is a minimalist piece written by"," ",Object(h.jsx)("a",{href:"https://en.wikipedia.org/wiki/Steve_Reich",target:"_blank",rel:"noopener noreferrer",children:"Steve Reich"}),". It is written for two performers and is performed entirely by clapping."]}),Object(h.jsxs)("p",{children:["For a live example, watch the"," ",Object(h.jsx)("a",{href:"https://www.youtube.com/watch?v=liYkRarIDfo",target:"_blank",rel:"noopener noreferrer",children:"video performed by London Sinfonietta percussionists"})," ","David Hockings and Toby Kearney."]}),Object(h.jsxs)("p",{children:["Developed by"," ",Object(h.jsx)("a",{href:"https://github.com/alvaro-cuesta/",children:"\xc1lvaro Cuesta"}),". Code available on"," ",Object(h.jsx)("a",{href:"https://github.com/alvaro-cuesta/reich",children:"GitHub"}),"."]})]}),Object(h.jsxs)("section",{children:[Object(h.jsx)("h2",{children:"Instructions"}),Object(h.jsx)("p",{children:'Press "START" and wait for the initial count to 6, then clap as "Clap 2" by pressing "Z" in your keyboard.'})]}),Object(h.jsxs)("section",{children:[Object(h.jsx)("h2",{children:"Settings"}),Object(h.jsxs)("div",{className:"controls",children:[Object(h.jsxs)("fieldset",{className:"tempo",children:[Object(h.jsx)(v,Object(r.a)({label:"Tempo:"},x)),Object(h.jsx)(v,Object(r.a)({label:"Repeats:"},P)),Object(h.jsx)(v,Object(r.a)({label:"Swing:"},q))]}),Object(h.jsxs)("fieldset",{children:[Object(h.jsx)("div",{className:"noselect",children:"Sounds:"}),Object(h.jsx)(v,Object(r.a)({label:"Clap 1"},A)),Object(h.jsx)(v,Object(r.a)({label:"Clap 2"},R)),Object(h.jsx)(v,Object(r.a)({label:"Metronome"},V)),Object(h.jsx)(v,Object(r.a)({label:"Count"},D))]})]})]}),Object(h.jsx)("main",{children:Object(h.jsx)(j,{buttonHandler:a,buttonLabel:s,clapPattern:I,pattern:t,pulse:n,repeats:P.value,userInput:O})})]})},A=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,19)).then((function(t){var n=t.getCLS,c=t.getFID,a=t.getFCP,s=t.getLCP,i=t.getTTFB;n(e),c(e),a(e),s(e),i(e)}))},R=new AudioContext;i.a.render(Object(h.jsx)(a.a.StrictMode,{children:Object(h.jsx)(q,{context:R})}),document.getElementById("root")),A()}},[[18,1,2]]]);
//# sourceMappingURL=main.2cb0df20.chunk.js.map