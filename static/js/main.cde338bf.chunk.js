(this.webpackJsonpreich=this.webpackJsonpreich||[]).push([[0],{13:function(e,t,n){},15:function(e,t,n){"use strict";n.r(t);var c=n(1),a=n.n(c),r=n(5),l=n.n(r),s=(n(13),n(2)),i=n(3),u=function(e,t,n,c){var a=e.scrollTop,r=t-e.scrollTop,l=performance.now();requestAnimationFrame((function s(){var i=performance.now()-l;i>n?e.scrollTop=t:(e.scrollTop=c(i,a,r,n),requestAnimationFrame(s))}))},o=n(0),h=a.a.forwardRef((function(e,t){var n=e.clapPattern,c=e.head,a=e.shift,r=e.highlightPulse,l=e.currentPattern,s=e.donePattern,i=e.userInput,u=e.className;return Object(o.jsxs)("div",{ref:t,className:"clap-row ".concat(u),children:[Object(o.jsx)("div",{className:"head",children:c}),Object(o.jsx)("div",{className:"pattern",children:n.map((function(e,t){var c=(t+a)%n.length,u=n[c],h="cell pulse ".concat(u?"clap":"silence"," ").concat(t===r?"highlight":""," "),d=void 0===i||void 0===i[t],b=d?"no-hit":i[t]>2/3?"hit-bad":i[t]>1/3?"hit-ok":"hit-good";return l?(t<r||t===r&&!d)&&(h+=b):(s||void 0!==i)&&(h+=b),Object(o.jsx)("div",{className:h},t)}))})]})}));h.defaultProps={head:"",shift:0,className:""};var d=h,b=function(e,t,n,c){return n*Math.sin(e/c*(Math.PI/2))+t},j=function(e){var t=e.buttonHandler,n=e.buttonLabel,a=e.clapPattern,r=e.pattern,l=e.pulse,s=e.repeats,i=e.userInput,h=e.className,j=r;(void 0===r||r<=0)&&(r=0);var f=Object(c.useRef)([]),p=Object(c.useRef)(null),v=Object(c.useCallback)((function(e){u(document.scrollingElement,f.current[1+e].offsetTop-f.current[1].offsetTop+p.current.offsetTop+4,300,b)}),[]);return Object(c.useEffect)((function(){void 0!==j&&v(j<=0?0:j)}),[j,v]),Object(o.jsxs)("div",{className:"pattern-table noselect ".concat(h),ref:function(e){p.current=e},children:[Object(o.jsxs)("div",{className:"arrow-row",children:[Object(o.jsx)("div",{className:"head",children:Object(o.jsx)("button",{className:"noselect",onClick:t,children:n})}),Object(o.jsx)("div",{className:"pattern",children:a.map((function(e,t){return Object(o.jsx)("div",{className:"cell arrow",children:j>=-1&&t===l?"\u25bc":""},t)}))})]}),Object(o.jsx)("div",{className:"pattern-clap1",children:Object(o.jsx)(d,{clapPattern:a,head:"Clap 1 \u27a1",shift:0,highlightPulse:l})}),Object(o.jsxs)("div",{className:"pattern-clap2",children:[Array.apply(null,{length:1}).map((function(e,t){return Object(o.jsx)(d,{ref:function(e){f.current[t]=e},clapPattern:a,className:"empty"},t)})),Array.apply(null,{length:(a.length+1)*s}).map((function(e,t){return Object(o.jsx)(d,{ref:function(e){f.current[t+1]=e},clapPattern:a,className:t===r?"highlight":"",highlightPulse:t===r?l:void 0,head:t===r?"Clap 2 \u27a1":"",shift:Math.floor(t/s),userInput:i[t],donePattern:t<j,currentPattern:t===j},t)})),Object(o.jsxs)("div",{className:"padder",children:[Object(o.jsx)("div",{className:"head"}),Object(o.jsx)("div",{className:"pattern empty",children:a.map((function(e,t){return Object(o.jsx)("div",{className:"cell pulse"},t)}))})]})]})]})};j.defaultProps={className:""};var f=j,p=n(8),v=function(e){var t=e.label,n=Object(p.a)(e,["label"]);return Object(o.jsxs)("label",{children:["checkbox"!==n.type?Object(o.jsx)("span",{className:"label noselect",children:t}):null,Object(o.jsx)("input",Object(s.a)({},n)),"checkbox"===n.type?Object(o.jsx)("span",{className:"label noselect",children:t}):null]})},m=n(6),O=n(7),g=function(){function e(t,n){Object(m.a)(this,e),this.f=n,this.context=t,this.oscillator=t.createOscillator(),this.oscillator.type="square",this.oscillator.frequency.value=n,this.gain=t.createGain(),this.gain.gain.value=0,this.oscillator.start(),this.oscillator.connect(this.gain),this.gain.connect(t.destination)}return Object(O.a)(e,[{key:"schedule",value:function(e,t,n){this.gain.gain.setValueAtTime(e,t),this.gain.gain.setValueAtTime(0,n)}},{key:"scheduleFrequency",value:function(e,t){this.oscillator.frequency.setValueAtTime(e,t)}},{key:"cancelScheduledValues",value:function(){var e=this.context.currentTime;this.oscillator.frequency.cancelScheduledValues(e),this.gain.gain.cancelScheduledValues(e),this.gain.gain.value=0,this.oscillator.frequency.value=this.f}},{key:"disconnect",value:function(){this.gain.disconnect(),this.oscillator.disconnect()}}]),e}(),x=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.min,a=t.max,r=t.step,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,s=Object(c.useCallback)((function(e){var t=parseInt(e,10);return Number.isInteger(t)?(void 0!==n&&(t=Math.max(n,t)),void 0!==a&&(t=Math.min(a,t)),t):l}),[n,a,l]),u=Object(c.useState)((function(){return s(localStorage.getItem(e))})),o=Object(i.a)(u,2),h=o[0],d=o[1],b=Object(c.useCallback)((function(t){var n=t.target.value,c=s(n);localStorage.setItem(e,c),d(c)}),[e,s]);return{type:"number",min:n,max:a,step:r,value:h,onChange:b}},k=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.min,a=t.max,r=t.step,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,s=Object(c.useCallback)((function(e){var t=parseFloat(e,10);return"number"!==typeof t||isNaN(t)?l:(void 0!==n&&(t=Math.max(n,t)),void 0!==a&&(t=Math.min(a,t)),t)}),[n,a,l]),u=Object(c.useState)((function(){return s(localStorage.getItem(e))})),o=Object(i.a)(u,2),h=o[0],d=o[1],b=Object(c.useCallback)((function(t){var n=t.target.value,c=s(n);localStorage.setItem(e,c),d(c)}),[e,s]);return{type:"number",min:n,max:a,step:r,value:h,onChange:b}},w=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Object(c.useCallback)((function(e){return!0===e||"true"===e||!1!==e&&"false"!==e&&t}),[t]),a=Object(c.useState)((function(){return n(localStorage.getItem(e))})),r=Object(i.a)(a,2),l=r[0],s=r[1],u=Object(c.useCallback)((function(t){var c=t.target.checked,a=n(c);localStorage.setItem(e,a),s(a)}),[e,n]);return{type:"checkbox",checked:l,onChange:u}},y=function(e,t){return(t+e%t)%t},T=function(e){return 60/e},S=function(e,t,n,c,a){if(null===c)return{};var r=(a-c)/T(e),l=2*Math.floor(r)+(y(r,1)<t?0:1);return{pattern:Math.floor(l/n),pulse:y(l,n),totalPulses:l}},N=function(e,t,n,c){return n+(Math.floor(c/2)+(c%2===0?0:t))*T(e)},C=[!0,!0,!0,!1,!0,!0,!1,!0,!1,!0,!0,!1],P=.0125,I=[90],M=[77],R=function(e){var t=e.context,n=Object(c.useState)({startTime:null,now:null}),a=Object(i.a)(n,2),r=a[0],l=a[1],u=Object(c.useState)([]),h=Object(i.a)(u,2),d=h[0],b=h[1],j=x("tempo",{min:1,max:999,step:1},120),p=x("repeats",{min:1,max:999,step:1},4),m=k("swing",{min:.1,max:.9,step:.01},.5),O=w("clap1",!0),y=w("clap2",!0),R=w("metronome",!1),V=w("countMetronome",!0),F=Object(c.useRef)(null),q=Object(c.useRef)(null),A=Object(c.useRef)(null),D=Object(c.useRef)(null),E=Object(c.useRef)(null),L=Object(c.useRef)(null),_=Object(c.useCallback)((function(){clearInterval(D.current),F.current.cancelScheduledValues(),q.current.cancelScheduledValues(),A.current.cancelScheduledValues(),l({startTime:null,now:null})}),[]),H=Object(c.useCallback)((function(e,t,n,c){var a=N(j.value,m.value,r.startTime,n),l=a+P,s=0===e?1:.25;if(t>=0){O.checked&&C[e%C.length]&&F.current.schedule(s,a,l);var i=Math.floor(t/p.value);y.checked&&C[(i+e)%C.length]&&q.current.schedule(s,a,l)}var u=R.checked&&t>=0&&e%2===0,o=V.checked&&-1===t&&e%2===0;(u||o)&&(A.current.scheduleFrequency(0===e?1780:890,a),A.current.schedule(s,a,l))}),[O.checked,y.checked,R.checked,V.checked,p.value,r.startTime,m.value,j.value]);Object(c.useEffect)((function(){var e=S(j.value,m.value,C.length,r.startTime,r.now),t=e.pattern,n=e.pulse,c=e.totalPulses;if(t>=(C.length+1)*p.value)_();else{if(null===E.current)E.current=0;else{if(n===E.current)return;E.current=n}var a=n,l=t;(a+=1)===C.length&&(a=0,l+=1),t>=(C.length+1)*p.value||H(a,l,c+1)}}),[_,H,p.value,j.value,m.value,r.startTime,r.now]);var B=Object(c.useCallback)((function(e){var n=e.timeStamp;t.resume();var c=t.currentTime;F.current.cancelScheduledValues(),q.current.cancelScheduledValues(),A.current.cancelScheduledValues(),L.current=n,E.current=null,l({startTime:c+T(j.value)/2*C.length,now:c}),b([]),V.checked&&A.current.schedule(1,c,c+P),D.current=setInterval((function(){l((function(e){return{startTime:e.startTime,now:t.currentTime}}))}),1)}),[t,j.value,V.checked]);Object(c.useEffect)((function(){return F.current=new g(t,440),q.current=new g(t,230),A.current=new g(t,1780),function(){_(),F.current.disconnect(),q.current.disconnect(),A.current.disconnect()}}),[t,_]),Object(c.useEffect)((function(){var e=function(e){var n=e.repeat,c=e.key,a=e.keyCode,l=e.timeStamp;if(!n){var s=S(j.value,m.value,C.length,r.startTime,t.currentTime),i=s.pattern,u=s.pulse,o=(performance.now()-l)/1e3,h=function(e,t,n,c,a){var r=S(e,t,n,c,a).totalPulses,l=T(e);return{currPulseDiff:(a-N(e,t,c,r))/(l*t),nextPulseDiff:(N(e,t,c,r+1)-a)/(l*(1-t))}}(j.value,m.value,C.length,r.startTime,t.currentTime-o),d=h.currPulseDiff,f=h.nextPulseDiff;I.includes(a)?(console.log("clap1",d,f),b((function(e){if(void 0===e[i]&&(e[i]=[]),d<f)e[i][u]=d;else{var t=u+1,n=i;t===C.length&&(t=0,void 0===e[n+=1]&&(e[n]=[])),e[n][t]=f}return e}))):M.includes(a)?console.log("clap2",d,f):console.log(c,a)}};return window.addEventListener("keydown",e,!1),function(){window.removeEventListener("keydown",e,!1)}}),[j.value,m.value,r.startTime,t]);var G,J,K=S(j.value,m.value,C.length,r.startTime,t.currentTime),Y=K.pattern,Z=K.pulse;return void 0===Y?(G=B,J="Start"):Y<0?(G=_,J=Math.floor(Z/2)+1):(G=_,J="Stop"),Object(o.jsxs)("div",{className:"reich-app",children:[Object(o.jsx)("header",{children:Object(o.jsx)("h1",{children:Object(o.jsx)("a",{href:"/reich",children:"Reich Clapping Trainer"})})}),Object(o.jsxs)("section",{children:[Object(o.jsxs)("p",{children:[Object(o.jsx)("a",{href:"https://en.wikipedia.org/wiki/Clapping_Music",target:"_blank",rel:"noopener noreferrer",children:"Clapping Music"})," ","is a minimalist piece written by"," ",Object(o.jsx)("a",{href:"https://en.wikipedia.org/wiki/Steve_Reich",target:"_blank",rel:"noopener noreferrer",children:"Steve Reich"}),". It is written for two performers and is performed entirely by clapping."]}),Object(o.jsxs)("p",{children:["For a live example, watch the"," ",Object(o.jsx)("a",{href:"https://www.youtube.com/watch?v=liYkRarIDfo",target:"_blank",rel:"noopener noreferrer",children:"video performed by London Sinfonietta percussionists"})," ","David Hockings and Toby Kearney."]}),Object(o.jsxs)("p",{children:["Developed by"," ",Object(o.jsx)("a",{href:"https://github.com/alvaro-cuesta/",children:"\xc1lvaro Cuesta"}),". Code available on"," ",Object(o.jsx)("a",{href:"https://github.com/alvaro-cuesta/reich",children:"GitHub"}),"."]})]}),Object(o.jsxs)("section",{children:[Object(o.jsx)("h2",{children:"Instructions"}),Object(o.jsx)("p",{children:'Press "START" and wait for the initial count to 6, then clap as "Clap 2" by pressing "Z" in your keyboard.'})]}),Object(o.jsxs)("section",{children:[Object(o.jsx)("h2",{children:"Settings"}),Object(o.jsxs)("div",{className:"controls",children:[Object(o.jsxs)("fieldset",{className:"tempo",children:[Object(o.jsx)(v,Object(s.a)({label:"Tempo:"},j)),Object(o.jsx)(v,Object(s.a)({label:"Repeats:"},p)),Object(o.jsx)(v,Object(s.a)({label:"Swing:"},m))]}),Object(o.jsxs)("fieldset",{children:[Object(o.jsx)("div",{className:"noselect",children:"Sounds:"}),Object(o.jsx)(v,Object(s.a)({label:"Clap 1"},O)),Object(o.jsx)(v,Object(s.a)({label:"Clap 2"},y)),Object(o.jsx)(v,Object(s.a)({label:"Metronome"},R)),Object(o.jsx)(v,Object(s.a)({label:"Count"},V))]})]})]}),Object(o.jsx)("main",{children:Object(o.jsx)(f,{buttonHandler:G,buttonLabel:J,clapPattern:C,pattern:Y,pulse:Z,repeats:p.value,userInput:d})})]})},V=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,16)).then((function(t){var n=t.getCLS,c=t.getFID,a=t.getFCP,r=t.getLCP,l=t.getTTFB;n(e),c(e),a(e),r(e),l(e)}))},F=new AudioContext;l.a.render(Object(o.jsx)(a.a.StrictMode,{children:Object(o.jsx)(R,{context:F})}),document.getElementById("root")),V()}},[[15,1,2]]]);
//# sourceMappingURL=main.cde338bf.chunk.js.map