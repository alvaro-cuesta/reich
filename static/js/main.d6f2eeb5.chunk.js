(this.webpackJsonpreich=this.webpackJsonpreich||[]).push([[0],{14:function(e,t,n){},16:function(e,t,n){"use strict";n.r(t);var c=n(1),r=n.n(c),a=n(5),l=n.n(a),s=(n(14),n(8)),u=n(3),o=n(2),i=function(e,t,n,c){var r=e.scrollTop,a=t-e.scrollTop,l=performance.now();requestAnimationFrame((function s(){var u=performance.now()-l;u>n?e.scrollTop=t:(e.scrollTop=c(u,r,a,n),requestAnimationFrame(s))}))},h=n(0),p=r.a.forwardRef((function(e,t){var n=e.clapPattern,c=e.head,r=e.shift,a=e.highlightPulse,l=e.currentPattern,s=e.donePattern,u=e.userInput,o=e.className;return Object(h.jsxs)("div",{ref:t,className:"clap-row ".concat(o),children:[Object(h.jsx)("div",{className:"head",children:c}),Object(h.jsx)("div",{className:"pattern",children:n.map((function(e,t){var c=(t+r)%n.length,o=n[c],i="cell pulse ".concat(o?"clap":"silence"," ").concat(t===a?"highlight":""," "),p=void 0===u||void 0===u[t],f=p?"no-hit":u[t]>2/3?"hit-bad":u[t]>1/3?"hit-ok":"hit-good";return l?(t<a||t===a&&!p)&&(i+=f):(s||void 0!==u)&&(i+=f),Object(h.jsx)("div",{className:i},t)}))})]})}));p.defaultProps={head:"",shift:0,className:""};var f=p,d=function(e,t,n,c){return n*Math.sin(e/c*(Math.PI/2))+t},b=function(e){var t=e.buttonHandler,n=e.buttonLabel,r=e.clapPattern,a=e.pattern,l=e.pulse,s=e.repeats,u=e.userInput,o=e.className,p=a;(void 0===a||a<=0)&&(a=0);var b=Object(c.useRef)([]),j=Object(c.useRef)(null),m=Object(c.useRef)(!0),O=Object(c.useCallback)((function(e){i(document.scrollingElement,b.current[e].offsetTop-j.current.offsetTop+b.current[e].offsetHeight-4,300,d)}),[]);return Object(c.useEffect)((function(){j.current.scrollTop=b.current[0]-j.current.offsetTop+b.current[0].offsetHeight-4}),[]),Object(c.useEffect)((function(){m.current?m.current=!1:O(void 0===a||a<=0?0:a)}),[a,O]),Object(h.jsxs)("div",{className:"pattern-table noselect ".concat(o),ref:function(e){j.current=e},children:[Object(h.jsxs)("div",{className:"arrow-row",children:[Object(h.jsx)("div",{className:"head",children:Object(h.jsx)("button",{className:"noselect",onClick:t,children:n})}),Object(h.jsx)("div",{className:"pattern",children:r.map((function(e,t){return Object(h.jsx)("div",{className:"cell arrow",children:p>=-1&&t===l?"\u25bc":""},t)}))})]}),Object(h.jsx)("div",{className:"pattern-clap1",children:Object(h.jsx)(f,{clapPattern:r,head:"Clap 1 \u27a1",shift:0,highlightPulse:l})}),Object(h.jsxs)("div",{className:"pattern-clap2",children:[Array.apply(null,{length:1}).map((function(e,t){return Object(h.jsx)(f,{ref:function(e){b.current[t]=e},clapPattern:r,className:"empty"},t)})),Array.apply(null,{length:(r.length+1)*s}).map((function(e,t){return Object(h.jsx)(f,{ref:function(e){b.current[t+1]=e},clapPattern:r,className:t===a?"highlight":"",highlightPulse:t===a?l:void 0,head:t===a?"Clap 2 \u27a1":"",shift:Math.floor(t/s),userInput:u[t],donePattern:t<p,currentPattern:t===p},t)})),Object(h.jsxs)("div",{className:"padder",children:[Object(h.jsx)("div",{className:"head"}),Object(h.jsx)("div",{className:"pattern empty",children:r.map((function(e,t){return Object(h.jsx)("div",{className:"cell pulse"},t)}))})]})]})]})};b.defaultProps={className:""};var j=b,m=n(9),O=function(e){var t=e.label,n=Object(m.a)(e,["label"]);return Object(h.jsxs)("label",{children:["checkbox"!==n.type?Object(h.jsx)("span",{className:"label noselect",children:t}):null,Object(h.jsx)("input",Object(o.a)({},n)),"checkbox"===n.type?Object(h.jsx)("span",{className:"label noselect",children:t}):null]})},g=n(6),v=n(7),x=function(){function e(t,n){Object(g.a)(this,e),this.f=n,this.context=t,this.oscillator=t.createOscillator(),this.oscillator.type="square",this.oscillator.frequency.value=n,this.gain=t.createGain(),this.gain.gain.value=0,this.oscillator.start(),this.oscillator.connect(this.gain),this.gain.connect(t.destination)}return Object(v.a)(e,[{key:"schedule",value:function(e,t,n){this.gain.gain.setValueAtTime(e,t),this.gain.gain.setValueAtTime(0,n)}},{key:"scheduleFrequency",value:function(e,t){this.oscillator.frequency.setValueAtTime(e,t)}},{key:"cancelScheduledValues",value:function(){var e=this.context.currentTime;this.oscillator.frequency.cancelScheduledValues(e),this.gain.gain.cancelScheduledValues(e),this.gain.gain.value=0,this.oscillator.frequency.value=this.f}},{key:"disconnect",value:function(){this.gain.disconnect(),this.oscillator.disconnect()}}]),e}(),w=[!0,!0,!0,!1,!0,!0,!1,!0,!1,!0,!0,!1],y=.0125,k=[90],N=[77],C=function(e,t,n){var c=localStorage.getItem(e);return null!==c?t(c):n},P=function(e){return"true"===e},T=function(e,t,n){return"undefined"===typeof n&&(n=function(e){return e}),Object(c.useCallback)((function(c){var r=c.target,a=r.type,l=r.value,s=r.checked;"checkbox"===a?(localStorage.setItem(t,s),e((function(e){return Object(o.a)(Object(o.a)({},e),{},Object(u.a)({},"".concat(t),n(s)))}))):(localStorage.setItem(t,l),e((function(e){return Object(o.a)(Object(o.a)({},e),{},Object(u.a)({},"".concat(t),n(l)))})))}),[e,t,n])},I=function(e){var t=e.context,n=Object(c.useState)({tempo:C("tempo",parseInt,120),repeats:C("repeats",parseInt,4),swing:C("swing",parseFloat,.5),clap1:C("clap1",P,!0),clap2:C("clap2",P,!0),metronome:C("metronome",P,!1),countMetronome:C("countMetronome",P,!0),startTime:!1,now:!1,userInput:!1}),r=Object(s.a)(n,2),a=r[0],l=r[1],u=a.tempo,i=a.repeats,p=a.swing,f=a.clap1,d=a.clap2,b=a.metronome,m=a.countMetronome,g=a.userInput,v=Object(c.useRef)(null),I=Object(c.useRef)(null),S=Object(c.useRef)(null),M=Object(c.useRef)(null),V=Object(c.useRef)(null),R=Object(c.useRef)(null),F=60/a.tempo,q=Object(c.useCallback)((function(){clearInterval(M.current),v.current.cancelScheduledValues(),I.current.cancelScheduledValues(),S.current.cancelScheduledValues(),l((function(e){return Object(o.a)(Object(o.a)({},e),{},{startTime:!1,now:!1})}))}),[]),E=Object(c.useCallback)((function(){var e=a.startTime,t=a.swing,n=a.now;if(!1===e)return{};var c=(n-e)/F,r=2*Math.floor(c)+((1+c%1)%1<t?0:1);if(e>=n){for(var l=r;l<0;)l+=w.length;return{pattern:Math.floor(r/w.length),pulse:l,totalPulses:r}}return{pattern:Math.floor(r/w.length),pulse:r%w.length,totalPulses:r}}),[F,a.startTime,a.swing,a.now]),A=Object(c.useCallback)((function(e){var t=a.startTime,n=a.swing;return t+(Math.floor(e/2)+(e%2===0?0:n))*F}),[F,a.startTime,a.swing]),L=Object(c.useCallback)((function(e,t,n,c){var r=a.clap1,l=a.clap2,s=a.metronome,u=a.countMetronome,o=a.repeats,i=A(n),h=i+y,p=0===e?1:.25;if(t>=0){r&&w[e%w.length]&&v.current.schedule(p,i,h);var f=Math.floor(t/o);l&&w[(f+e)%w.length]&&I.current.schedule(p,i,h)}(s&&t>=0&&e%2===0||u&&-1===t&&e%2===0)&&(S.current.scheduleFrequency(0===e?1780:890,i),S.current.schedule(p,i,h))}),[A,a.clap1,a.clap2,a.metronome,a.countMetronome,a.repeats]);Object(c.useEffect)((function(){var e=a.repeats,t=E(),n=t.pattern,c=t.pulse,r=t.totalPulses;if(n>=(w.length+1)*e)q();else{if(!1===V.current)V.current=0;else{if(c===V.current)return;V.current=c}(c+=1)===w.length&&(c=0,n+=1),n>=(w.length+1)*e||L(c,n,r+=1)}}),[E,q,L,a.repeats]);var D=Object(c.useCallback)((function(e){var n=e.timeStamp,c=a.countMetronome;t.resume();var r=t.currentTime;v.current.cancelScheduledValues(),I.current.cancelScheduledValues(),S.current.cancelScheduledValues(),R.current=n,V.current=!1,l((function(e){return Object(o.a)(Object(o.a)({},e),{},{startTime:r+F/2*w.length,now:r,userInput:[]})})),c&&S.current.schedule(1,r,r+y),M.current=setInterval((function(){l((function(e){return Object(o.a)(Object(o.a)({},e),{},{now:t.currentTime})}))}),1)}),[t,F,a.countMetronome]);Object(c.useEffect)((function(){return v.current=new x(t,440),I.current=new x(t,230),S.current=new x(t,1780),function(){q(),v.current.disconnect(),I.current.disconnect(),S.current.disconnect()}}),[t,q]);var H=Object(c.useCallback)((function(e){var n=a.swing,c=E().totalPulses,r=t.currentTime-e/1e3;return{currPulseDiff:(r-A(c))/(F*n),nextPulseDiff:(A(c+1)-r)/(F*(1-n))}}),[E,A,F,t,a.swing]);Object(c.useEffect)((function(){var e=function(e){var t=e.repeat,n=e.key,c=e.keyCode,r=e.timeStamp;if(!t){var s=a.userInput,u=E(),i=u.pattern,h=u.pulse,p=H(performance.now()-r),f=p.currPulseDiff,d=p.nextPulseDiff;k.includes(c)?(console.log("clap1",f,d),void 0===s[i]&&(s[i]=[]),f<d?s[i][h]=f:((h+=1)===w.length&&(h=0,void 0===s[i+=1]&&(s[i]=[])),s[i][h]=d),l((function(e){return Object(o.a)(Object(o.a)({},e),{},{userInput:s})}))):N.includes(c)?console.log("clap2",f,d):console.log(n,c)}};return window.addEventListener("keydown",e,!1),function(){window.removeEventListener("keydown",e,!1)}}),[E,H,a.userInput]);var B,J,G=E(),z=G.pattern,K=G.pulse;return void 0===z?(B=D,J="Start"):z<0?(B=q,J=Math.floor(K/2)+1):(B=q,J="Stop"),Object(h.jsxs)("div",{className:"reich-app",children:[Object(h.jsxs)("div",{className:"controls",children:[Object(h.jsxs)("fieldset",{className:"tempo",children:[Object(h.jsx)(O,{label:"Tempo:",type:"number",min:1,max:999,step:1,value:u,onChange:T(l,"tempo",parseInt)}),Object(h.jsx)(O,{label:"Repeats:",type:"number",min:1,max:999,step:1,value:i,onChange:T(l,"repeats",parseInt)}),Object(h.jsx)(O,{label:"Swing:",type:"number",min:.1,max:.9,step:.01,value:p,onChange:T(l,"swing",parseFloat)})]}),Object(h.jsxs)("fieldset",{children:[Object(h.jsx)("div",{className:"noselect",children:"Sounds:"}),Object(h.jsx)(O,{label:"Clap 1",type:"checkbox",checked:f,onChange:T(l,"clap1")}),Object(h.jsx)(O,{label:"Clap 2",type:"checkbox",checked:d,onChange:T(l,"clap2")}),Object(h.jsx)(O,{label:"Metronome",type:"checkbox",checked:b,onChange:T(l,"metronome")}),Object(h.jsx)(O,{label:"Count",type:"checkbox",checked:m,onChange:T(l,"countMetronome")})]})]}),Object(h.jsx)(j,{buttonHandler:B,buttonLabel:J,clapPattern:w,pattern:z,pulse:K,repeats:i,userInput:g})]})},S=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,17)).then((function(t){var n=t.getCLS,c=t.getFID,r=t.getFCP,a=t.getLCP,l=t.getTTFB;n(e),c(e),r(e),a(e),l(e)}))},M=new AudioContext;l.a.render(Object(h.jsx)(r.a.StrictMode,{children:Object(h.jsx)(I,{context:M})}),document.getElementById("root")),S()}},[[16,1,2]]]);
//# sourceMappingURL=main.d6f2eeb5.chunk.js.map