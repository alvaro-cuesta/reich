$card-width = 5em
$card-height = $card-width * 1.61803398875
$open-duration = 500ms
$open-wait = 250ms

* { box-sizing: border-box }

body {
  text-rendering: optimizeLegibility
}

.card-container {
  perspective: 500px
  width: $card-width * 3
}

.card {
  display: flex
  flex-direction: row

  width: 100%

  transform-style: preserve-3d
}

.card-left, .card-center, .card-right {
  width: $card-width
  height: $card-height

  position: relative
  top: 0
}

.card-face {
  width: 100%
  height: 100%

  backface-visibility: hidden

  position: absolute
  top: 0
  left: 0
}

.card-left, .card-center, .card-right, .card-face {
  transform-style: preserve-3d
}

.card-left {
  transform-origin: 100% 50% 0
}

.card-right {
  transform-origin: 0% 50% 0
}

.card-action {
  display: flex
  flex-direction: column
}

.card-action-row {
  height: 33%
}

.card-active-action {
  cursor: pointer
}

.card-outside-left, .card-outside-center, .card-outside-right {
  transform: rotateY(180deg) translateZ(1px)
}

// Card states

// Draw

.card.card-drawing {
  animation: draw 1s ease-out 0s 1 normal forwards running

  .card-left {
    transform: rotateY(180deg)
    z-index: 100
  }

  .card-outside-left {
    cursor: pointer
  }

  .card-right {
    transform: rotateY(-180deg)
    z-index: 50
  }
}

// Open

.card.card-open {
  .card-left {
    transform: rotateY(180deg)
    animation: unflip-left $open-duration ease-out 0s 1 normal forwards running
  }

  .card-right {
    transform: rotateY(-180deg)
    animation: unflip-right $open-duration ease-out $open-wait 1 normal forwards running
  }
}

 // Closing

.card.card-closing-left {
  .card-left {
    transform: rotateY(0deg)
    animation: flip-right $open-duration ease-out 0s 1 normal forwards running
    z-index: 50
  }

  .card-right {
    transform: rotateY(0deg)
    animation: flip-left $open-duration ease-out $open-wait 1 normal forwards running
    z-index: 100
  }
}

.card.card-closing-right {
  .card-left {
    transform: rotateY(0deg)
    animation: flip-right $open-duration ease-out $open-wait 1 normal forwards running
    z-index: 100
  }

  .card-right {
    transform: rotateY(0deg)
    animation: flip-left $open-duration ease-out 0ms 1 normal forwards running
    z-index: 50
  }
}

// End states

.card.card-discarding {
  animation: discard 1s ease-out ($open-duration + $open-wait) 1 normal forwards running
}

.card-container.card-removing {
  animation: remove 1s ease-out ($open-duration + $open-wait) 1 normal forwards running
}

// Card animations

@keyframes draw {
  0% {
    transform: translate3d(-100px, 0px, 0px) rotateY(180deg)
  }
  40% {
    transform: translate3d(-10px, 0px, 100px) rotateY(180deg)
  }
  50% {
    transform: translate3d(-10px, 0px, 100px) rotateY(180deg)
  }
  100% {
    transform: translate3d(0px, 0px, 0px) rotateY(0deg)
  }
}

@keyframes discard {
  0% {
    transform: translate3d(0px, 0px, 0px) rotateY(0deg)
  }
  40% {
    transform: translate3d(10px, 0px, 100px) rotateY(180deg)
  }
  50% {
    transform: translate3d(10px, 0px, 100px) rotateY(180deg)
  }
  100% {
    transform: translate3d(100px, 0px, 0px) rotateY(180deg)
  }
}

@keyframes remove {
  from { opacity: 1 }
  to { opacity: 0 }
}

// Flips

@keyframes unflip-left {
  from { transform: rotateY(180deg) }
  to { transform: rotateY(0deg) }
}

@keyframes flip-left {
  from { transform: rotateY(0deg) }
  to { transform: rotateY(-180deg) }
}

@keyframes flip-right {
  from { transform: rotateY(0deg) }
  to { transform: rotateY(180deg) }
}

@keyframes unflip-right {
  from { transform: rotateY(-180deg) }
  to { transform: rotateY(0deg) }
}
